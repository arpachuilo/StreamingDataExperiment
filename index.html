<!DOCTYPE html>
<head>
  <meta charset='utf-8'>
  <script src='https://d3js.org/d3.v4.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/1.3.0/moment-duration-format.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.js'></script>

  <script src='./scripts/StreamingChart.js'></script>
  <script src='./scripts/DynamicTDDisplay.js'></script>
  <script src='./scripts/CircularProxy.js'></script>
  <script src='./scripts/BoundingBoxProxy.js'></script>
  <script src='./scripts/WholeScreenProxy.js'></script>

  <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css'>
  <link rel='stylesheet' href='style.css'>

  <title>Streaming Selection</title>
</head>

<body onresize='resize()'>
  <div id='root'>
    <div class='row'>
      <div class='container' id='StreamingChart'></div>
    </div>

    <div class='row'>
      <div class='container'>
        <span>Y Value: </span>
        <select id='yValue' onchange='onYChange()'>
          <option value='followers'>Followers</option>
          <option value='following'>Following</option>
          <option value='rt_count'>Retweet Count</option>
          <option value='fav_count'>Favorite Count</option>
        </select>
        <span>ProxyMethod: </span>
        <select id='proxyValue' onchange='onProxyChange()'>
          <option value='CircularProxy'>Circular Proxy</option>
          <option value='BoundingBoxProxy'>Bounding Box Proxy</option>
          <option value='WholeScreenProxy'>WholeScreen Proxy</option>
        </select>
      </div>
    </div>

    <div class='row'>
      <div class='container' id='columnLayout'>
      </div>
    </div>
  </div>

  <script>
    function onYChange () {
      chart.y(document.getElementById('yValue').value)
    }

    function onProxyChange () {
      var fn = window[document.getElementById('proxyValue').value]
      chart.cursor(fn)
    }

    var data = []
    var selectedData = []

    var chart = StreamingChart(d3.select('#StreamingChart'))
      .x('time')
      .y('followers')
      .cursor(CircularProxy)
      .clickHandler(function (d, i) {
        if (!selectedData.includes(d)) {
          selectedData.push(d)
          dynamicTD
            .setData(selectedData)
            .update()
        }
      })
      .start()

    var dynamicTD = DynamicCardGrid(document.getElementById('columnLayout'))
      .setData(selectedData)
      .update()

    d3.json('./data/output.json', function (error, json) {
      // Make for easier access to vars . . .
      data = json

      var tStart = d3.min(data, function (d) {
        return +d.time
      })

      chart
        .setNow(tStart)
        .setData(data)
    })

  </script>
</body>
